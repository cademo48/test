<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Test Webpage</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      margin: 0;
    }
    #bg {
      position: fixed;
      inset: 0;
      z-index: -1;
      filter: blur(10px);
      transition: background-color 0.5s;
    }
    #display {
      font-size: 32px;
      margin-bottom: 10px;
    }
    #emoji {
      font-size: 48px;
      display: block;
      margin-bottom: 20px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/sentiment@5.0.1/build/sentiment.min.js"></script>
</head>
<body>
  <div id="bg"></div>
  <div id="emoji"></div>
  <div id="display"></div>
  <input id="textInput" type="text" placeholder="Enter text">
  <button id="submitBtn">Submit</button>

  <script>
    // Larger emoji library with keywords for basic intent detection
    const emojiLibrary = [
      {emoji: 'ðŸ˜€', keywords: ['happy','smile','grin','joy']},
      {emoji: 'ðŸ˜‚', keywords: ['laugh','lol','funny']},
      {emoji: 'ðŸ˜Š', keywords: ['blush','cheerful','pleased']},
      {emoji: 'ðŸ˜¢', keywords: ['sad','cry','tear','unhappy']},
      {emoji: 'ðŸ˜¡', keywords: ['angry','mad','furious']},
      {emoji: 'ðŸ˜', keywords: ['love','heart','adore']},
      {emoji: 'ðŸ˜Ž', keywords: ['cool','sunglasses','chill']},
      {emoji: 'ðŸ˜‡', keywords: ['angel','good','innocent']},
      {emoji: 'ðŸ¤”', keywords: ['think','question','hmm']},
      {emoji: 'ðŸ˜´', keywords: ['sleep','tired','zzz']},
      {emoji: 'ðŸ¤¢', keywords: ['sick','nausea','ill']},
      {emoji: 'ðŸ¤–', keywords: ['robot','ai','machine']},
      {emoji: 'ðŸŽ‰', keywords: ['party','celebrate','yay']},
      {emoji: 'ðŸŽ‚', keywords: ['birthday','cake','celebration']},
      {emoji: 'ðŸ’»', keywords: ['computer','coding','laptop']},
      {emoji: 'ðŸ±', keywords: ['cat','kitty']},
      {emoji: 'ðŸ¶', keywords: ['dog','puppy']},
      {emoji: 'ðŸŒ§ï¸', keywords: ['rain','storm','wet']},
      {emoji: 'â˜€ï¸', keywords: ['sun','sunny','bright']},
      {emoji: 'ðŸ•', keywords: ['pizza','food','eat']},
      // fall back emoji
      {emoji: 'ðŸ’¬', keywords: []}
    ];

    function chooseEmoji(text) {
      const words = text.toLowerCase().split(/\W+/);
      let bestEmoji = 'ðŸ’¬';
      let bestScore = 0;
      for (const item of emojiLibrary) {
        let score = 0;
        for (const w of words) {
          if (item.keywords.includes(w)) score++;
        }
        if (score > bestScore) {
          bestScore = score;
          bestEmoji = item.emoji;
        }
      }
      if (bestScore === 0 && window.Sentiment) {
        const sentiment = new Sentiment();
        const result = sentiment.analyze(text);
        if (result.score > 1) return 'ðŸ˜Š';
        if (result.score < -1) return 'ðŸ˜¢';
        return 'ðŸ˜';
      }
      return bestEmoji;
    }

    function averageColorFromEmoji(emoji) {
      const canvas = document.createElement('canvas');
      canvas.width = canvas.height = 64;
      const ctx = canvas.getContext('2d');
      ctx.font = '64px serif';
      ctx.fillText(emoji, 0, 64);
      const data = ctx.getImageData(0, 0, 64, 64).data;
      let r = 0, g = 0, b = 0, count = 0;
      for (let i = 0; i < data.length; i += 4) {
        if (data[i + 3] > 0) {
          r += data[i];
          g += data[i + 1];
          b += data[i + 2];
          count++;
        }
      }
      if (count === 0) return '#ffffff';
      r = Math.round(r / count);
      g = Math.round(g / count);
      b = Math.round(b / count);
      return `rgb(${r}, ${g}, ${b})`;
    }

    document.getElementById('submitBtn').addEventListener('click', () => {
      const text = document.getElementById('textInput').value.trim();
      document.getElementById('display').textContent = text;
      const emoji = chooseEmoji(text);
      document.getElementById('emoji').textContent = emoji;
      document.getElementById('bg').style.backgroundColor = averageColorFromEmoji(emoji);
    });
  </script>
</body>
</html>

